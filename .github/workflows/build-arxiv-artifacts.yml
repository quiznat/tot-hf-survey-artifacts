name: Build arXiv Artifacts

on:
  push:
    branches: [main]
    paths:
      - 'paper.html'
      - 'submission/build_llm_markdown.sh'
      - 'submission/convert_to_arxiv.sh'
      - 'submission/ARXIV_CONVERSION_NOTES.md'
      - '.github/workflows/build-arxiv-artifacts.yml'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install pandoc
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc

      - name: Generate arXiv LaTeX source
        run: |
          bash submission/convert_to_arxiv.sh

      - name: Generate LLM-friendly Markdown
        run: |
          bash submission/build_llm_markdown.sh

      - name: Package arXiv bundle
        run: |
          mkdir -p submission/arxiv
          cp -r assets submission/arxiv/assets
          cp tot-hf-agents-llm.md submission/arxiv/tot-hf-agents-llm.md
          cp LICENSE submission/arxiv/
          tar -czf submission/arxiv/arxiv-bundle.tgz -C submission/arxiv .

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: arxiv-artifacts
          path: |
            submission/arxiv/main.tex
            tot-hf-agents-llm.md
            submission/arxiv/arxiv-bundle.tgz
